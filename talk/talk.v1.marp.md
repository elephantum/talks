---
marp: true
html: true
theme: default
paginate: true
title: Apache Iceberg –∏–∑–Ω—É—Ç—Ä–∏
---

<!--
[–°–ª–∞–π–¥ 1]
–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ Apache Iceberg ‚Äî –Ω–æ –Ω–µ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞ –∑–∞–≥–ª—è–Ω–µ–º –ø–æ–¥ –∫–∞–ø–æ—Ç. –†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å, –∏ –ø–æ—á–µ–º—É Iceberg –¥–∞—ë—Ç ACID-–≥–∞—Ä–∞–Ω—Ç–∏–∏. –≠—Ç–æ –±—É–¥–µ—Ç —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–∫–ª–∞–¥, —Ç–∞–∫ —á—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å.

ACID:
- Atomicity (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º, –ª–∏–±–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–≤—Å–µ.
- Consistency (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥—Ä—É–≥–æ–µ.
- Isolation (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å): –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞.
- Durability (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å): –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.
-->

# Apache Iceberg –∏–∑–Ω—É—Ç—Ä–∏
## –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

–†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω Iceberg –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º: –æ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ ACID-–≥–∞—Ä–∞–Ω—Ç–∏–π.

---

<!--
[–°–ª–∞–π–¥ 2]
–û–±–æ –º–Ω–µ: –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–∏–∫–µ—Ä–µ, –µ–≥–æ –æ–ø—ã—Ç–µ –∏ —Ç–µ–∫—É—â–µ–π —Ä–æ–ª–∏.
-->

# –û–±–æ –º–Ω–µ

## –ê–Ω–¥—Ä–µ–π –¢–∞—Ç–∞—Ä–∏–Ω–æ–≤

- –õ—é–±–ª—é —É–∑–Ω–∞–≤–∞—Ç—å –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–∏—Ä –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–± —ç—Ç–æ–º
- Founder Epoch8 - –∑–∞–∫–∞–∑–Ω–∞—è ML-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- ex-Google, ex-Yandex

---

<!--
[–°–ª–∞–π–¥ 3]
–ü–ª–∞–Ω —É –Ω–∞—Å —Ç–∞–∫–æ–π.
–°–Ω–∞—á–∞–ª–∞ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ –±–æ–ª–∏. –ü–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –¥–æ–±—Ä—ã–π Hive Metastore –∏ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞ S3 –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –Ω–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–ª–æ –º–Ω–æ–≥–æ.
–ó–∞—Ç–µ–º —Ä–∞–∑–±–µ—Ä—ë–º –∞–Ω–∞—Ç–æ–º–∏—é Iceberg. –≠—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å: –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –¥–µ—Ä–µ–≤–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –ø–æ–π–º—ë–º, —á—Ç–æ —Ç–∞–∫–æ–µ Manifest List –∏ Manifest File.
–ü–æ—Ç–æ–º –ø–µ—Ä–µ–π–¥—ë–º –∫ –¥–∏–Ω–∞–º–∏–∫–µ: –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å. –†–∞–∑–±–µ—Ä—ë–º Write Path, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Optimistic Concurrency Control –∏ –æ—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è ACID-–≥–∞—Ä–∞–Ω—Ç–∏–∏.
–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∏: Time Travel, —ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º—ã –∏ —Å–∫—Ä—ã—Ç–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
–ò –≤ –∫–æ–Ω—Ü–µ ‚Äî –¥–µ–º–æ. –°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É, –ø–æ–ø–∏—à–µ–º –≤ –Ω–µ—ë –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ JSON-—Ñ–∞–π–ª—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–∏–º–∏ –≥–ª–∞–∑–∞–º–∏.
-->

# –û —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏–º

1. **–ë–æ–ª—å**: –ü–æ—á–µ–º—É Hive-—Ç–∞–±–ª–∏—Ü—ã –ª–æ–º–∞—é—Ç—Å—è –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ö–∞–∫ Iceberg —É—Å—Ç—Ä–æ–µ–Ω –≤–Ω—É—Ç—Ä–∏ (Metadata, Manifests)
3. **–ú–µ—Ö–∞–Ω–∏–∫–∞**: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Read, Write –∏ ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. **–§–∏—á–∏**: Time Travel, Schema Evolution, Hidden Partitioning
5. **–ü—Ä–∞–∫—Ç–∏–∫–∞**: –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª—ã —Ä—É–∫–∞–º–∏ —á–µ—Ä–µ–∑ PyIceberg + DuckDB

---

<!--
[–°–ª–∞–π–¥ 4]
–ù–∞—á–Ω—ë–º —Å –ø—Ä–æ–±–ª–µ–º—ã. –ö–∞–∫ –º—ã –ø—Ä–∏–≤—ã–∫–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–µ—Ç? Hive-style —Ç–∞–±–ª–∏—Ü—ã.
–≠—Ç–æ –ø–æ —Å—É—Ç–∏ –ø—Ä–æ—Å—Ç–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π: "–≤—Å–µ Parquet-—Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ /data/table/date=2024-01-01/ ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞ 1 —è–Ω–≤–∞—Ä—è".
–ó–≤—É—á–∏—Ç –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ, –º–æ–∂–Ω–æ –∑–∞–π—Ç–∏ —á–µ—Ä–µ–∑ `ls` –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å. –ù–æ –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ (PB –¥–∞–Ω–Ω—ã—Ö, —Ç—ã—Å—è—á–∏ –ø–∞—Ä—Ç–∏—Ü–∏–π) —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É.

1. **O(N) Listing**: –ß—Ç–æ–±—ã —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å `SELECT * FROM table WHERE date > '2024-01-01'`, –¥—Ä–∞–π–≤–µ—Ä—É –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª–∏—Å—Ç–∏–Ω–≥ –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤. –ù–∞ S3 `LIST` ‚Äî —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –ï—Å–ª–∏ —É –≤–∞—Å –º–∏–ª–ª–∏–æ–Ω —Ñ–∞–π–ª–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–∏–Ω—É—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∞–º –∑–∞–ø—Ä–æ—Å —á–∏—Ç–∞–µ—Ç 10 —Å—Ç—Ä–æ–∫.

2. **–ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**: –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ ETL-job –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ. –û–Ω –∑–∞–ø–∏—Å–∞–ª 50 —Ñ–∞–π–ª–æ–≤ –∏–∑ 100 –∏ —É–ø–∞–ª (OOM, network issue).
   - –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—ã –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å.
   - –í Hive —á–∏—Ç–∞—Ç–µ–ª–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∏–¥—è—Ç —ç—Ç–∏ 50 —Ñ–∞–π–ª–æ–≤. –û–Ω–∏ –≤–∏–¥—è—Ç "–≥—Ä—è–∑–Ω—ã–µ", —á–∞—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
   - –ß—Ç–æ–±—ã –ø–æ—á–∏–Ω–∏—Ç—å, –Ω—É–∂–Ω–æ —Ä—É–∫–∞–º–∏ –∏–¥—Ç–∏ –∏ —É–¥–∞–ª—è—Ç—å —ç—Ç–∏ —Ñ–∞–π–ª—ã.

3. **S3 Rename**: –í HDFS `rename` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ‚Äî —ç—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (—Å–º–µ–Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è –≤ NameNode). –í S3 (–∏ –¥—Ä—É–≥–∏—Ö Object Storage) `rename` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –≠—Ç–æ `COPY` –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ + `DELETE` —Å—Ç–∞—Ä–æ–≥–æ.
   - –≠—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∏–≥–∞–±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö).
   - –≠—Ç–æ –¥–æ—Ä–æ–≥–æ (API calls).
   - –≠—Ç–æ –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–æ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Ç–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥—É–±–ª–∏ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö).

4. **–ñ–µ—Å—Ç–∫–æ—Å—Ç—å (Rigidity)**:
   - **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º. –ß–µ—Ä–µ–∑ –≥–æ–¥ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ, –Ω—É–∂–Ω–æ –ø–æ —á–∞—Å–∞–º. –í Hive –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥. –í–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –í–°–Æ —Ç–∞–±–ª–∏—Ü—É (Restatement), —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—ã–µ –ø–∞–ø–∫–∏.
   - **–°—Ö–µ–º–∞**: –•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É `user_id` –≤ `customer_id`? –í Parquet —Å—Ö–µ–º–∞ –∑–∞—à–∏—Ç–∞ –≤ —Ñ–∞–π–ª. Hive –º–∞–ø–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –∏–º–µ–Ω–∏ (–∏–ª–∏ –ø–æ –∏–Ω–¥–µ–∫—Å—É). –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç —á—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤, –≥–¥–µ —Å—Ç–∞—Ä–æ–µ –∏–º—è.

Q: –ê —á—Ç–æ, –∫—Ä–æ–º–µ Hive –Ω–∏—á–µ–≥–æ –Ω–µ –±—ã–ª–æ?
A: –í –º–∏—Ä–µ Open Source Data Lake ‚Äî –ø–æ —Å—É—Ç–∏ –Ω–µ—Ç.
- –ë—ã–ª–∏ **MPP (Vertica, Greenplum)**, –Ω–æ —ç—Ç–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–∏—Å—Ç–µ–º—ã, —Ç—É–¥–∞ –Ω–∞–¥–æ –≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
- –ë—ã–ª **Hive ACID**, –Ω–æ –æ–Ω —Å–ª–æ–∂–Ω—ã–π –∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Hive-–¥–≤–∏–∂–∫—É (Spark —Å –Ω–∏–º –ø–ª–æ—Ö–æ –¥—Ä—É–∂–∏–ª).
- –ë—ã–ª **Kudu**, –Ω–æ —ç—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä–∞–¥–∂ (—Å–µ—Ä–≤–µ—Ä–∞), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞ S3.
- –ü–æ—ç—Ç–æ–º—É –¥–ª—è "–ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª–æ–≤ –Ω–∞ S3" Hive –±—ã–ª –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º.
-->

# –ü—Ä–æ–±–ª–µ–º–∞: Hive-—Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥: `.../table/date=2024-01-01/*.parquet`

1. **üê¢ O(N) Listing**: –ß—Ç–æ–±—ã —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `ls -R`. –ù–∞ S3 —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω—É—Ç—ã.
2. **üí• –ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**: Job —É–ø–∞–ª –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ –∑–∞–ø–∏—Å–∏? –ß–∏—Ç–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ ("–≥—Ä—è–∑–Ω—ã–µ") –¥–∞–Ω–Ω—ã–µ.
3. **‚òÅÔ∏è S3 Rename**: –í –æ–±–ª–∞–∫–∞—Ö –Ω–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ `rename`. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ = `copy` + `delete` –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤. –≠—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –¥–æ—Ä–æ–≥–æ.
4. **üóø –ñ–µ—Å—Ç–∫–æ—Å—Ç—å**: –°–º–µ–Ω–∞ —Å—Ö–µ–º—ã –∏–ª–∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –±–æ–ª—å. –ß–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö (Restatement).

---

<!--
[–°–ª–∞–π–¥ 5]
Iceberg ‚Äî —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã. –≠—Ç–æ **Open Table Format**.
–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è —Å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–¥–µ—Å—å —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü–∞.

1. **–≠—Ç–æ –Ω–µ —Ñ–∞–π–ª–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç**: Iceberg —Å–∞–º –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–µ–º —Ñ–æ—Ä–º–∞—Ç—ã: Parquet, ORC, Avro. –ï—Å–ª–∏ –≤—ã –æ—Ç–∫—Ä–æ–µ—Ç–µ –ø–∞–ø–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ Iceberg-—Ç–∞–±–ª–∏—Ü—ã, –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ–±—ã—á–Ω—ã–µ Parquet-—Ñ–∞–π–ª—ã. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Ö –ª—é–±—ã–º —Ç—É–ª–æ–º, –¥–∞–∂–µ –±–µ–∑ Iceberg (–Ω–æ –ø–æ–ª—É—á–∏—Ç–µ "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —É—á–µ—Ç–∞ —É–¥–∞–ª–µ–Ω–∏–π –∏ –≤–µ—Ä—Å–∏–π).

2. **–≠—Ç–æ –Ω–µ –¥–≤–∏–∂–æ–∫ (Engine)**: Iceberg ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è. –£ –Ω–µ–≥–æ –Ω–µ—Ç —Å–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å.
   - –í—ã –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ jar-–Ω–∏–∫ –∫ Spark ‚Äî Spark –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–Ω–∏–º–∞—Ç—å Iceberg.
   - –í—ã –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ –ø–ª–∞–≥–∏–Ω –∫ Trino ‚Äî Trino –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–Ω–∏–º–∞—Ç—å Iceberg.
   - DuckDB —É–º–µ–µ—Ç —á–∏—Ç–∞—Ç—å Iceberg –∏–∑ –∫–æ—Ä–æ–±–∫–∏.
   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å **Data Lakehouse**: –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (S3), –∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–∏–º–∏ —Ä–∞–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. Spark –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö ETL, Trino –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, Flink –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.

3. **–≠—Ç–æ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ì–ª–∞–≤–Ω–æ–µ –≤ Iceberg ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ç–æ–≥–æ, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –º—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º —Ñ–∞–π–ª—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, Time Travel –∏ Schema Evolution –ø–æ–≤–µ—Ä—Ö –æ–±—ã—á–Ω–æ–≥–æ S3.

**–ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä—ã–Ω–∫–∞**: Iceberg –Ω–µ –æ–¥–∏–Ω–æ–∫.
- **Delta Lake**: –°–æ–∑–¥–∞–Ω Databricks. –î–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –±—ã–ª –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–º (—á–∞—Å—Ç–∏—á–Ω–æ), —Å–µ–π—á–∞—Å –æ—Ç–∫—Ä—ã—Ç. –û—á–µ–Ω—å –∫—Ä—É—Ç–æ–π, –Ω–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ —Å–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π Spark/Databricks.
- **Apache Hudi**: –°–æ–∑–¥–∞–Ω Uber. –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–µ –∏ upsert-–∞—Ö. –û—á–µ–Ω—å –º–æ—â–Ω—ã–π, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.
- **Iceberg**: –°–æ–∑–¥–∞–Ω Netflix. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª—Å—è –∫–∞–∫ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, cloud-native —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ–≥—Ä–æ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü. –°–µ–π—á–∞—Å –¥–µ-—Ñ–∞–∫—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö Data Lakehouse.
-->

# –†–µ—à–µ–Ω–∏–µ: Open Table Format

Iceberg ‚Äî —ç—Ç–æ **–æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**.

- **–ù–µ —Ñ–∞–π–ª–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Parquet/ORC/Avro –¥–ª—è –¥–∞–Ω–Ω—ã—Ö.
- **–ù–µ –¥–≤–∏–∂–æ–∫**: –†–∞–±–æ—Ç–∞–µ—Ç —Å Spark, Trino, Flink, DuckDB.
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –û–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ —Ç–∞–±–ª–∏—Ü—É —Å ACID-–≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏.

> **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**: Delta Lake (Databricks), Apache Hudi (Uber).

---

<!--
[–°–ª–∞–π–¥ 6]
–í —á—ë–º –∂–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ Iceberg –æ—Ç Hive?
–í Hive —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
- –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `ls`.
- –ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `rm`.
–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã, –Ω–æ –Ω–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

Iceberg –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —ç—Ç—É –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–∫–æ–º —Ñ–∞–π–ª–æ–≤ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**.
–ú—ã –ø–µ—Ä–µ—Å—Ç–∞—ë–º —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ù–∞–º –≤—Å—ë —Ä–∞–≤–Ω–æ, –≥–¥–µ –ª–µ–∂–∞—Ç —Ñ–∞–π–ª—ã. –û–Ω–∏ –º–æ–≥—É—Ç –ª–µ–∂–∞—Ç—å –≤ –æ–¥–Ω–æ–π –ø–ª–æ—Å–∫–æ–π –ø–∞–ø–∫–µ, –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –±–∞–∫–µ—Ç–∞–º.
–ì–ª–∞–≤–Ω–æ–µ ‚Äî —ç—Ç–æ **Manifest**, —Å–ø–∏—Å–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞–ø–∏—Å–∞–Ω–æ:
1. –§–∞–π–ª `data-a.parquet` –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–∞–±–ª–∏—Ü–µ.
2. –í –Ω—ë–º 1000 —Å—Ç—Ä–æ–∫.
3. –í –∫–æ–ª–æ–Ω–∫–µ `id` –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç 1 –¥–æ 1000.

–≠—Ç–æ –¥–∞—ë—Ç –Ω–∞–º —Å—É–ø–µ—Ä—Å–∏–ª—É:
- **O(1) Planning**: –ù–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ª–∏—Å—Ç–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ú—ã —á–∏—Ç–∞–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç –∏ —Å—Ä–∞–∑—É –∑–Ω–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã.
- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**: –ß—Ç–æ–±—ã –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, –º—ã –ø—Ä–æ—Å—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–æ –ø–æ–¥–º–µ–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤. –ë—ã–ª–æ [A, B], —Å—Ç–∞–ª–æ [A, B, C]. –ß–∏—Ç–∞—Ç–µ–ª–∏ –ª–∏–±–æ –≤–∏–¥—è—Ç —Å—Ç–∞—Ä—ã–π —Å–ø–∏—Å–æ–∫, –ª–∏–±–æ –Ω–æ–≤—ã–π. –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π.

**–í–∞–∂–Ω—ã–π –Ω—é–∞–Ω—Å –ø—Ä–æ ACID**:
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Iceberg Catalog (Hive, Glue, JDBC) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å **—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã**.
–ï—Å–ª–∏ –≤—ã –ø–∏—à–µ—Ç–µ –≤ Table A –∏ Table B ‚Äî —ç—Ç–æ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ACID –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü, –Ω—É–∂–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ—Ç–æ–∫ (Branching), –Ω–∞–ø—Ä–∏–º–µ—Ä **Project Nessie** –∏–ª–∏ **LakeFS**. –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ Git –¥–ª—è –¥–∞–Ω–Ω—ã—Ö: –∫–æ–º–º–∏—Ç –≤ –≤–µ—Ç–∫—É –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É –≤—Å–µ–≥–æ Data Lake.
-->

# –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è: –§–∞–π–ª—ã, –∞ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

Hive: "–ß—Ç–æ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ ‚Äî —Ç–æ –∏ —Ç–∞–±–ª–∏—Ü–∞"
Iceberg: "–ß—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ —Å–ø–∏—Å–∫–µ ‚Äî —Ç–æ –∏ —Ç–∞–±–ª–∏—Ü–∞"

- **–û—Ç–≤—è–∑–∫–∞ –æ—Ç FS**: –§–∞–π–ª—ã –º–æ–≥—É—Ç –ª–µ–∂–∞—Ç—å –≥–¥–µ —É–≥–æ–¥–Ω–æ.
- **–¢–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫**: –ú—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞.
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ —Ö—Ä–∞–Ω–∏–º `min/max`, `null count`, `row count`.

---

<!--
[–°–ª–∞–π–¥ 7]
–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ ‚Äî –∞–Ω–∞—Ç–æ–º–∏—è. –ö–∞–∫ –∏–º–µ–Ω–Ω–æ Iceberg —Ö—Ä–∞–Ω–∏—Ç —ç—Ç–æ—Ç "—Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤"?
–≠—Ç–æ –Ω–µ –æ–¥–∏–Ω –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Ñ–∞–π–ª (–æ–Ω –±—ã –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª—Å—è). –≠—Ç–æ –¥–µ—Ä–µ–≤–æ.
–î–µ—Ä–µ–≤–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö:
1. **Data Files**: –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ (Parquet).
2. **Manifest Files**: –°–ø–∏—Å–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –û–¥–∏–Ω –º–∞–Ω–∏—Ñ–µ—Å—Ç –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç—ã—Å—è—á–∏ —Ñ–∞–π–ª–æ–≤.
3. **Manifest List**: –°–ø–∏—Å–æ–∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤. –°–æ–±–∏—Ä–∞–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –≤ –æ–¥–∏–Ω –°–Ω–∞–ø—à–æ—Ç.
4. **Metadata File**: –ö–æ—Ä–µ–Ω—å –¥–µ—Ä–µ–≤–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ç–∞–±–ª–∏—Ü—ã. –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∞–ø—à–æ—Ç–æ–≤.
5. **Catalog**: –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ "—Ç–µ–∫—É—â–∏–π" Metadata File.

–ö–æ–≥–¥–∞ –º—ã —á–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É, –º—ã –∏–¥–µ–º —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑: Catalog -> Metadata -> Manifest List -> Manifests -> Data.
–ö–æ–≥–¥–∞ –º—ã –ø–∏—à–µ–º, –º—ã —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≤–µ—Ç–∫–∏ —ç—Ç–æ–≥–æ –¥–µ—Ä–µ–≤–∞ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –∏ –≤ –∫–æ–Ω—Ü–µ –∞—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.
-->

# –ê–Ω–∞—Ç–æ–º–∏—è Iceberg-—Ç–∞–±–ª–∏—Ü—ã

![h:500](diagrams/anatomy.svg)

---

<!--
[–°–ª–∞–π–¥ 8]
–ù–∞—á–Ω—ë–º —Å –≤–µ—Ä—à–∏–Ω—ã. **Catalog**.
–ï–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –∑–Ω–∞—Ç—å, –≥–¥–µ –ª–µ–∂–∏—Ç **—Ç–µ–∫—É—â–∏–π** —Ñ–∞–π–ª –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`metadata.json`).
–≠—Ç–æ –æ—á–µ–Ω—å —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π. –ü–æ —Å—É—Ç–∏, —ç—Ç–æ Key-Value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
`Table Name` -> `Location of current metadata.json`

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞–≥–∏—è ACID-–∫–æ–º–º–∏—Ç–∞.
–ö–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é **CAS (Compare-And-Swap)**:
"–û–±–Ω–æ–≤–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ `v2.metadata.json`, –¢–û–õ–¨–ö–û –ï–°–õ–ò —Å–µ–π—á–∞—Å –æ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `v1.metadata.json`".

–ï—Å–ª–∏ –¥–≤–∞ –ø–∏—Å–∞—Ç–µ–ª—è –ø—Ä–∏–¥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ–¥–∏–Ω –≤—ã–∏–≥—Ä–∞–µ—Ç, –∞ –≤—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É –∏ –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å retry.
–≠—Ç–æ –±–∞–∑–∞ –¥–ª—è Optimistic Concurrency Control.

–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–º–∏:
- **Hive Metastore**: –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–µ-—Ñ–∞–∫—Ç–æ –≤ Hadoop.
- **AWS Glue / DynamoDB**: –í –æ–±–ª–∞–∫–µ.
- **REST Catalog**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –ø—Ä–æ—Å—Ç–æ HTTP API.
- **Nessie**: "Git for Data", –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –≤–µ—Ç–∫–∏ –∏ –º–µ—Ä–∂–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞—Ç–∞–ª–æ–≥–∞.
-->

# Catalog

**–ó–∞–¥–∞—á–∞**: –•—Ä–∞–Ω–∏—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ç–µ–∫—É—â–∏–π `metadata.json`.

- **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è**: `Map<TableName, MetadataLocation>`
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `CAS` (Compare-And-Swap) –¥–ª—è ACID.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
    - üêò Hive Metastore
    - ‚òÅÔ∏è AWS Glue / DynamoDB
    - üåê REST Catalog
    - üêô Nessie (Git-like semantics)

---

<!--
[–°–ª–∞–π–¥ 9]
–°–ø—É—Å–∫–∞–µ–º—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ. **Metadata File**.
–≠—Ç–æ JSON-—Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ü–µ–ª–∏–∫–æ–º.
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª, –≤—ã –∑–Ω–∞–µ—Ç–µ –æ —Ç–∞–±–ª–∏—Ü–µ –≤—Å—ë.

–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:
1. **–°—Ö–µ–º—ã (Schemas)**: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ö–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –±—ã–ª–∏ —É —Ç–∞–±–ª–∏—Ü—ã. –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ + –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä–æ–π —Å—Ö–µ–º–æ–π.
2. **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Partition Specs)**: –¢–æ–∂–µ —Å–ø–∏—Å–æ–∫! –ï—Å–ª–∏ –≤—ã –ø–æ–º–µ–Ω—è–ª–∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–Ω–µ–π –Ω–∞ –º–µ—Å—è—Ü—ã, Iceberg –ø–æ–º–Ω–∏—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –ø–æ –¥–Ω—è–º, –Ω–æ–≤—ã–µ ‚Äî –ø–æ –º–µ—Å—è—Ü–∞–º.
3. **–ò—Å—Ç–æ—Ä–∏—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤ (Snapshots)**: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π —Ç–∞–±–ª–∏—Ü—ã.
   - Snapshot 1 (–≤—á–µ—Ä–∞)
   - Snapshot 2 (—Å–µ–≥–æ–¥–Ω—è —É—Ç—Ä–æ–º)
   - Snapshot 3 (—Å–µ–π—á–∞—Å)
4. **–¢–µ–∫—É—â–∏–π —Å–Ω–∞–ø—à–æ—Ç (Current Snapshot ID)**: –ù–∞ –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é –º—ã —Å–º–æ—Ç—Ä–∏–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.

–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (INSERT, UPDATE, ALTER TABLE) —Å–æ–∑–¥–∞–µ—Ç **–ù–û–í–´–ô** —Ñ–∞–π–ª metadata.json (v1, v2, v3...). –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è Time Travel.
-->

# Metadata File (`v2.metadata.json`)

–ú–æ–∑–≥ —Ç–∞–±–ª–∏—Ü—ã. –•—Ä–∞–Ω–∏—Ç **–≤—Å—ë** —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

- **Schemas**: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã (v1, v2...).
- **Partition Specs**: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
- **Snapshots**: –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤ (`s1`, `s2`, `s3`...)
- **Current Snapshot**: `s3`

> üí° –ö–∞–∂–¥—ã–π –∫–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π JSON —Ñ–∞–π–ª. –°—Ç–∞—Ä—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è.

---

<!--
[–°–ª–∞–π–¥ 10]
–ò–¥–µ–º –¥–∞–ª—å—à–µ. –°–Ω–∞–ø—à–æ—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ **Manifest List**.
–ó–∞—á–µ–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π? –ü–æ—á–µ–º—É –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä—è–º–æ –≤ Metadata File?
–ü–æ—Ç–æ–º—É —á—Ç–æ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –ú–ò–õ–õ–ò–û–ù–´. –ï—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ JSON, –æ–Ω —Ä–∞—Å–ø—É—Ö–Ω–µ—Ç –¥–æ –≥–∏–≥–∞–±–∞–π—Ç–æ–≤, –∏ –º—ã –Ω–µ —Å–º–æ–∂–µ–º –µ–≥–æ –±—ã—Å—Ç—Ä–æ —á–∏—Ç–∞—Ç—å.

–ü–æ—ç—Ç–æ–º—É –º—ã –≥—Ä—É–ø–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –ø–∞—á–∫–∏ ‚Äî **–ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã**.
–ê Manifest List ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ —ç—Ç–∏—Ö –ø–∞—á–µ–∫.

–ù–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫. –≠—Ç–æ **–∏–Ω–¥–µ–∫—Å**.
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –∑–¥–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- –í —ç—Ç–æ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ `date` –æ—Ç `2024-01-01` –¥–æ `2024-01-05`.
- –í —ç—Ç–æ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è `bucket_id` = 0.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å **Partition Pruning** –Ω–∞ —Å–∞–º–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ.
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å `WHERE date = '2024-02-01'`, –º—ã –¥–∞–∂–µ –Ω–µ –±—É–¥–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∑–∞ —è–Ω–≤–∞—Ä—å. –ú—ã –∏—Ö –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–º.
-->

# Manifest List (`snap-123.avro`)

–°–ø–∏—Å–æ–∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –°–Ω–∞–ø—à–æ—Ç.

- **–§–æ—Ä–º–∞—Ç**: Avro (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π, –±–∏–Ω–∞—Ä–Ω—ã–π).
- **–†–æ–ª—å**: –ò–Ω–¥–µ–∫—Å –¥–ª—è Partition Pruning.
- **–°–æ–¥–µ—Ä–∂–∏—Ç**:
    - –ü—É—Ç—å –∫ Manifest File.
    - –î–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π partition-–∫–æ–ª–æ–Ω–æ–∫ (Min/Max).
    - `added_files_count`, `deleted_files_count`.

---

<!--
[–°–ª–∞–π–¥ 11]
–ò –Ω–∞–∫–æ–Ω–µ—Ü, **Manifest File**.
–≠—Ç–æ —Å–ø–∏—Å–æ–∫ —Å–∞–º–∏—Ö —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
–ù–æ –æ–ø—è—Ç—å –∂–µ, —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π. –≠—Ç–æ **–±–æ–≥–∞—Ç—ã–π –∏–Ω–¥–µ–∫—Å**.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –º—ã —Ö—Ä–∞–Ω–∏–º:
1. **Partition Data**: –ö –∫–∞–∫–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ñ–∞–π–ª.
2. **Metrics**:
   - –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ (`row_count`).
   - –°–∫–æ–ª—å–∫–æ null-–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ (`null_value_counts`).
   - **Lower Bounds / Upper Bounds**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ö–ê–ñ–î–û–ô –∫–æ–ª–æ–Ω–∫–∏ (–∏–ª–∏ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö).

–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ? –î–ª—è **Min/Max Filtering**.
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å: `SELECT * FROM logs WHERE user_id = 12345`.
Iceberg –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç, —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–∞–π–ª–∞ `data-a.parquet`:
- `user_id_min`: 100
- `user_id_max`: 500
12345 –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [100, 500]. –ó–Ω–∞—á–∏—Ç, —ç—Ç–æ—Ç —Ñ–∞–π–ª –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å. –ú—ã –¥–∞–∂–µ –Ω–µ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ S3, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ —Ñ—É—Ç–µ—Ä.
-->

# Manifest File (`manifest-abc.avro`)

–°–ø–∏—Å–æ–∫ Data Files —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

- **Data File Entry**:
    - `file_path`: `s3://.../data.parquet`
    - `partition`: `{date: 2024-01-01}`
    - `metrics`:
        - `row_count`: 10000
        - `lower_bounds`: `{id: 100}`
        - `upper_bounds`: `{id: 500}`

> üöÄ –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã (Skipping) –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

---

<!--
[–°–ª–∞–π–¥ 12]
–ù—É –∏ –≤ —Å–∞–º–æ–º –Ω–∏–∑—É ‚Äî **Data Files**.
–ó–¥–µ—Å—å –≤—Å—ë –ø—Ä–æ—Å—Ç–æ. –≠—Ç–æ –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã (Parquet/ORC/Avro).

–ù–æ –µ—Å—Ç—å –Ω—é–∞–Ω—Å. –í Iceberg v2 (Row-Level Deletes) –ø–æ—è–≤–∏–ª–∏—Å—å **Delete Files**.
–ï—Å–ª–∏ –º—ã —É–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫—É, –º—ã –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –≤–µ—Å—å –≥–∏–≥–∞–±–∞–π—Ç–Ω—ã–π Parquet-—Ñ–∞–π–ª (—ç—Ç–æ –±—ã–ª–æ –±—ã Copy-On-Write, –∏ —ç—Ç–æ –¥–æ–ª–≥–æ).
–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –ø–∏—à–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π **Delete File**, –≤ –∫–æ—Ç–æ—Ä–æ–º –≥–æ–≤–æ—Ä–∏–º: "–°—Ç—Ä–æ–∫–∞ X –≤ —Ñ–∞–π–ª–µ Y —É–¥–∞–ª–µ–Ω–∞".

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–≤–∏–∂–æ–∫ (Spark/Trino) –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—á–∏—Ç–∞—Ç—å Data File –∏ "–≤—ã—á–µ—Å—Ç—å" –∏–∑ –Ω–µ–≥–æ Delete File. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è Merge-On-Read.

–¢–∏–ø—ã Delete Files:
1. **Position Deletes**: "–£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ ‚Ññ100 –≤ —Ñ–∞–π–ª–µ A". (–ë—ã—Å—Ç—Ä–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ).
2. **Equality Deletes**: "–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ id=5". (–£–¥–æ–±–Ω–æ –¥–ª—è CDC, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏).

–ß–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å: "–ê –≥–¥–µ Update Files?". –ò—Ö –Ω–µ—Ç.
UPDATE –≤ Iceberg ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ **DELETE** —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫–∏ + **INSERT** –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏.
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö (Immutable Data). –ú—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ø–∏—Å—ã–≤–∞–µ–º —Ä—è–¥–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π Delete File –∏ –Ω–æ–≤—ã–π Data File.

–ê –∫–∞–∫ –º—ã –Ω–µ —É–¥–∞–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É? –í–µ–¥—å —É –Ω–µ–µ —Ç–æ–∂–µ `id=10`?
–¢—É—Ç —Ä–∞–±–æ—Ç–∞—é—Ç **Sequence Numbers**.
Delete File –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –¥–∞–Ω–Ω—ã–º, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–ø–∏—Å–∞–Ω—ã **—Ä–∞–Ω—å—à–µ** –Ω–µ–≥–æ (—Å—Ç—Ä–æ–≥–æ –º–µ–Ω—å—à–∏–π Sequence Number).
–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É Delete File –µ—ë –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç.
-->

# Data & Delete Files

Iceberg —Ö—Ä–∞–Ω–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –∏ "–∞–Ω—Ç–∏-–¥–∞–Ω–Ω—ã–µ".

- **Data Files**: –û–±—ã—á–Ω—ã–µ Parquet/ORC —Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏.
- **Delete Files** (Merge-On-Read):
    - **Position Deletes**: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª + –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏.
    - **Equality Deletes**: –ü—Ä–µ–¥–∏–∫–∞—Ç (`id = 5`).

> ‚ö†Ô∏è –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–≤–∏–∂–æ–∫ –¥–µ–ª–∞–µ—Ç `Data - Deletes`.

---

<!--
[–°–ª–∞–π–¥ 13]
–ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –Ω–∞ –¥–∏—Å–∫–µ. –≠—Ç–æ –±—ã–ª–∞ —Å—Ç–∞—Ç–∏–∫–∞.
–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –¥–∏–Ω–∞–º–∏–∫—É. –ö–∞–∫ –¥–≤–∏–∂–æ–∫ (Spark, Trino) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?
-->

# –ò –∫–∞–∫ —Å —ç—Ç–∏–º –≤—Å–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å?

---

<!--
[–°–ª–∞–π–¥ 14]
–ü–µ—Ä–≤—ã–π —à–∞–≥ –ª—é–±–æ–≥–æ —á—Ç–µ–Ω–∏—è ‚Äî **Snapshot Isolation**.
–ö–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ `SELECT * FROM table`, –¥—Ä–∞–π–≤–µ—Ä (Spark/Trino) –∏–¥—ë—Ç –≤ Catalog –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–ì–¥–µ metadata.json?".
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç `metadata.json` –∏ —Å–º–æ—Ç—Ä–∏—Ç –ø–æ–ª–µ `current-snapshot-id`.
–î–æ–ø—É—Å—Ç–∏–º, —ç—Ç–æ `s3`.

–í—Å—ë. –° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `s3`.
–î–∞–∂–µ –µ—Å–ª–∏ —á–µ—Ä–µ–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—É –ø—Ä–∏–¥–µ—Ç Writer –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç `s4`, `s5`, `s6` ‚Äî –≤—ã –∏—Ö –Ω–µ —É–≤–∏–¥–∏—Ç–µ.
–í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø—É–∑—ã—Ä–µ –≤—Ä–µ–º–µ–Ω–∏.

–≠—Ç–æ –¥–∞–µ—Ç –Ω–∞–º **Repeatable Reads** –∏ **Consistency**.
–ù–∏–∫–∞–∫–∏—Ö "–≥—Ä—è–∑–Ω—ã—Ö —á—Ç–µ–Ω–∏–π", –Ω–∏–∫–∞–∫–∏—Ö "—Ñ–∞–Ω—Ç–æ–º–Ω—ã—Ö —Å—Ç—Ä–æ–∫".
-->

# –ü—É—Ç—å —á—Ç–µ–Ω–∏—è: Snapshot Isolation

1. **Load Metadata**: –ß–∏—Ç–∞–µ–º `metadata.json` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.
2. **Pick Snapshot**: –§–∏–∫—Å–∏—Ä—É–µ–º `current-snapshot-id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `s3`).
3. **Ignore Updates**: –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã (`s4`, `s5`) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

> üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.

---

<!--
[–°–ª–∞–π–¥ 15]
–ú—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏ —Å–Ω–∞–ø—à–æ—Ç. –¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª—ã.
Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –æ—Ç—Å–µ—á–µ–Ω–∏—è (Pruning)**.

–£—Ä–æ–≤–µ–Ω—å 1: **Manifest List**.
–ó–¥–µ—Å—å –º—ã –æ—Ç—Å–µ–∫–∞–µ–º —Ü–µ–ª—ã–µ –≥—Ä—É–ø–ø—ã —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º.
–ó–∞–ø—Ä–æ—Å: `WHERE date = '2024-02-01'`.
–ú—ã —Å–º–æ—Ç—Ä–∏–º –≤ Manifest List. –í–∏–¥–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º `date` [2024-01-01, 2024-01-31].
–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ —Ü–µ–ª–∏–∫–æ–º! –ú—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å—ç–∫–æ–Ω–æ–º–∏–ª–∏ —á—Ç–µ–Ω–∏–µ —Ç—ã—Å—è—á —Ñ–∞–π–ª–æ–≤.

–£—Ä–æ–≤–µ–Ω—å 2: **Manifest File**.
–ó–¥–µ—Å—å –º—ã –æ—Ç—Å–µ–∫–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–ª–æ–Ω–æ–∫.
–ó–∞–ø—Ä–æ—Å: `WHERE id = 123`.
–ú—ã –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã. –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞.
–§–∞–π–ª A: `id` [0, 100]. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º.
–§–∞–π–ª B: `id` [100, 200]. **–ë–µ—Ä—ë–º!**

–í –∏—Ç–æ–≥–µ –∏–∑ –º–∏–ª–ª–∏–æ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –º—ã —Ä–µ–∞–ª—å–Ω–æ –±—É–¥–µ–º —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ 10.
-->

# Pruning: –ò–µ—Ä–∞—Ä—Ö–∏—è –æ—Ç—Å–µ—á–µ–Ω–∏—è

–ö–∞–∫ –Ω–∞–π—Ç–∏ –∏–≥–æ–ª–∫—É –≤ —Å—Ç–æ–≥–µ —Å–µ–Ω–∞ (–±—ã—Å—Ç—Ä–æ):

1. **Partition Pruning** (Manifest List):
   - –û—Ç—Å–µ–∫–∞–µ–º **–≥—Ä—É–ø–ø—ã —Ñ–∞–π–ª–æ–≤** –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –ø–∞—Ä—Ç–∏—Ü–∏–π.
   - `date` in [2024-01-01, 2024-01-31] ‚ùå

2. **Min/Max Filtering** (Manifest File):
   - –û—Ç—Å–µ–∫–∞–µ–º **–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–ª–æ–Ω–æ–∫.
   - `id` in [0, 100] ‚ùå

> üìâ Scan Planning –æ—Ç—Å–µ–∫–∞–µ—Ç 99% –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

---

<!--
[–°–ª–∞–π–¥ 16]
–ò—Ç–∞–∫, –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?
–í Hive, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —á–∏—Ç–∞—Ç—å, –Ω–∞–º —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –¥–µ–ª–∞—Ç—å `list directories` –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ. –ù–∞ S3 —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –¥–æ—Ä–æ–≥–æ.
–í Iceberg –º—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –ª–∏—Å—Ç–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏.
–ú—ã —á–∏—Ç–∞–µ–º Metadata File, –∑–∞—Ç–µ–º Manifest List.
–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –æ–≥—Ä–æ–º–Ω–∞—è, Spark –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å job *—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤*. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Distributed Planning**.
–ù–∞ –≤—ã—Ö–æ–¥–µ –º—ã –ø–æ–ª—É—á–∞–µ–º –Ω–∞–±–æ—Ä `FileScanTask` ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: "–ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª X, –±–∞–π—Ç—ã —Å 0 –ø–æ 1000".
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ø–µ—Ç–∞–±–∞–π—Ç–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º –∑–∞ —Å–µ–∫—É–Ω–¥—ã.
-->

# Scan Planning

–ö–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å SQL –≤ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤?

1. **Metadata Traversal**: –ß–∏—Ç–∞–µ–º Snapshot &rarr; Manifest List &rarr; Manifests.
2. **Filtering**: –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–µ–¥–∏–∫–∞—Ç—ã (Pruning) –Ω–∞ –ª–µ—Ç—É.
3. **Split Generation**: –°–æ–∑–¥–∞—ë–º –∑–∞–¥–∞—á–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è (`FileScanTask`).

üöÄ **–ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–æ?**
- **No File Listing**: –ù–∏–∫–∞–∫–∏—Ö `ls` –ø–æ S3.
- **O(Metadata)**, –∞ –Ω–µ O(Data).
- **Distributed Planning**: –ï—Å–ª–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –º–Ω–æ–≥–æ, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å!

---

<!--
[–°–ª–∞–π–¥ 17]
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∑–∞–ø–∏—Å–∏ (Write Path).
–≠—Ç–æ **Optimistic Concurrency Control**.
1. **Write Data**: –í–æ—Ä–∫–µ—Ä—ã –ø–∏—à—É—Ç Parquet-—Ñ–∞–π–ª—ã –Ω–∞ S3. –ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫. –ï—Å–ª–∏ —É–ø–∞–¥—ë—Ç ‚Äî –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º—É—Å–æ—Ä, –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ.
2. **Write Manifests**: –î—Ä–∞–π–≤–µ—Ä —Å–æ–±–∏—Ä–∞–µ—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –∏ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (min/max), –ø–∏—à–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç.
3. **Write Metadata**: –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π `metadata.json` —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–æ–≤—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç.
4. **Commit**: –°–∞–º—ã–π –≤–∞–∂–Ω—ã–π —à–∞–≥. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø–æ–¥–º–µ–Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.
"–ü–æ–º–µ–Ω—è–π `current-metadata` —Å `v1` –Ω–∞ `v2`".
–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —É—Å–ø–µ–ª –≤–∫–ª–∏–Ω–∏—Ç—å—Å—è ‚Äî –º—ã –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É –∏ —É–π–¥—ë–º –Ω–∞ —Ä–µ—Ç—Ä–∞–π.
-->

# –ü—É—Ç—å –∑–∞–ø–∏—Å–∏: –ê–Ω–∞—Ç–æ–º–∏—è –∫–æ–º–º–∏—Ç–∞

![h:500](diagrams/commit.svg)

---

<!--
[–°–ª–∞–π–¥ 18]
Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Optimistic Concurrency Control (OCC)**.
–ú—ã –∏—Å—Ö–æ–¥–∏–º –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ–¥–∫–∏.
–ù–∏–∫–∞–∫–∏—Ö –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ –∑–∞–ø–∏—Å—å.
–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –ß–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–Ω–∞–ø—à–æ—Ç (Base).
2. –ì–æ—Ç–æ–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø–∏—à–µ–º —Ñ–∞–π–ª—ã).
3. –ü—ã—Ç–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å CAS.
4. –ï—Å–ª–∏ –Ω–µ –≤—ã—à–ª–æ (–∫—Ç–æ-—Ç–æ —É—Å–ø–µ–ª —Ä–∞–Ω—å—à–µ) ‚Äî –º—ã –Ω–µ –ø–∞–¥–∞–µ–º —Å—Ä–∞–∑—É.
5. –ú—ã —Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –∏ –ø—ã—Ç–∞–µ–º—Å—è "–ø–µ—Ä–µ–±–∞–∑–∏—Ä–æ–≤–∞—Ç—å" (Rebase) —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ—Ä—Ö –Ω–æ–≤—ã—Ö.
-->

# Optimistic Concurrency Control

![OCC](diagrams/occ.svg)

1. **No Locks**: –ü–∏—Å–∞—Ç–µ–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
2. **Retry Loop**: –ï—Å–ª–∏ CAS –Ω–µ –ø—Ä–æ—à—ë–ª, –º—ã –Ω–µ –ø–∞–¥–∞–µ–º, –∞ –ø—ã—Ç–∞–µ–º—Å—è —Å–Ω–æ–≤–∞.
3. **Conflict Resolution**: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã –ª–∏ –Ω–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —á—É–∂–∏–º–∏.

---

<!--
[–°–ª–∞–π–¥ 19]
–ù–æ –Ω–µ –∫–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–ª CAS ‚Äî —ç—Ç–æ –æ—à–∏–±–∫–∞.
Iceberg –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã**.

–ü—Ä–∏–º–µ—Ä 1:
–Ø –¥–æ–±–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –∑–∞ **–Ø–Ω–≤–∞—Ä—å**.
–ö–æ–ª–ª–µ–≥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ **–§–µ–≤—Ä–∞–ª—å**.
–ú—ã –º–µ—à–∞–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥—É? –ù–µ—Ç.
Iceberg –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –º–æ–π –∫–æ–º–º–∏—Ç –ø–æ–≤–µ—Ä—Ö –µ–≥–æ –∫–æ–º–º–∏—Ç–∞.

–ü—Ä–∏–º–µ—Ä 2:
–Ø —á–∏—Ç–∞—é —Ñ–∞–π–ª A –∏ —É–¥–∞–ª—è—é –∏–∑ –Ω–µ–≥–æ —Å—Ç—Ä–æ–∫–∏.
–ö–æ–ª–ª–µ–≥–∞ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª A —Ü–µ–ª–∏–∫–æ–º.
–ö–æ–Ω—Ñ–ª–∏–∫—Ç! –ú–æ—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞. –¢—É—Ç –º—ã —É–ø–∞–¥—ë–º —Å –æ—à–∏–±–∫–æ–π.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å **–≤—ã—Å–æ–∫–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** –Ω–∞ –∑–∞–ø–∏—Å—å (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è Append-only).
-->

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

–ù–µ –≤—Å–µ –∫–æ–ª–ª–∏–∑–∏–∏ —Ñ–∞—Ç–∞–ª—å–Ω—ã. Iceberg –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π.

| –ú–æ—è –æ–ø–µ—Ä–∞—Ü–∏—è | –ß—É–∂–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è | –†–µ–∑—É–ª—å—Ç–∞—Ç |
| :--- | :--- | :--- |
| **Append** (Part A) | **Append** (Part B) | ‚úÖ Success (Rebase) |
| **Append** (Part A) | **Compaction** (Part B) | ‚úÖ Success |
| **Update** (File X) | **Delete** (File X) | ‚ùå Conflict |
| **Delete** (File X) | **Delete** (File X) | ‚ùå Conflict |

> üí° **Isolation Level**: Serializable / Snapshot Isolation.

---

<!--
[–°–ª–∞–π–¥ 20]
–û–¥–Ω–∞ –∏–∑ –ª—É—á—à–∏—Ö —Ñ–∏—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî **Hidden Partitioning**.

–í Hive –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ã–ª–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º. –í—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∫–æ–ª–æ–Ω–∫—É-–∫–æ—Å—Ç—ã–ª—å `day_str`.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–±—ã–≤–∞–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ `day_str`, –¥–µ–ª–∞–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ –ø–æ `timestamp`.
–†–µ–∑—É–ª—å—Ç–∞—Ç: Full Table Scan –∏ –ª–µ–∂–∞—â–∏–π –∫–ª–∞—Å—Ç–µ—Ä.

–í Iceberg –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ **—Ñ—É–Ω–∫—Ü–∏—è** –æ—Ç –¥–∞–Ω–Ω—ã—Ö.
`PARTITIONED BY (days(ts))`
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –∑–∞–ø—Ä–æ—Å –∫–∞–∫ –æ–±—ã—á–Ω–æ: `WHERE ts > ...`.
Iceberg —Å–∞–º –ø–æ–Ω–∏–º–∞–µ—Ç: "–ê–≥–∞, `ts` —Å–≤—è–∑–∞–Ω —Å –ø–∞—Ä—Ç–∏—Ü–∏–µ–π `days(ts)`, –∑–Ω–∞—á–∏—Ç –º–Ω–µ –Ω—É–∂–Ω—ã –ø–∞–ø–∫–∏ –æ—Ç —Ç–∞–∫–æ–π-—Ç–æ –¥–∞—Ç—ã".
–≠—Ç–æ —Å–ø–∞—Å–∞–µ—Ç –æ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.

Q: –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã? –í–µ–∑–¥–µ –ª–∏ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ?
A: –ù–∞–±–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏: `identity`, `bucket[N]`, `truncate[W]`, `year`, `month`, `day`, `hour`, `void`.
–û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç **–±–∏–Ω–∞—Ä–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ** –≤–æ –≤—Å–µ—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö (Java, Python, Rust, C++). –≠—Ç–æ —Å—Ç—Ä–æ–≥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å–ø–µ–∫–∏. –§–∞–π–ª, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π Spark, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç—Å—è –≤ DuckDB.

Q: –ê –µ—Å–ª–∏ —è –∑–∞—Ö–æ—á—É —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é?
A: **–ù–µ–ª—å–∑—è**. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç UDF –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–Ω–∞—á–µ —Å–ª–æ–º–∞–ª–∞—Å—å –±—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –¥–≤–∏–∂–∫–∞–º–∏.
–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ ‚Äî –≤—ã—á–∏—Å–ª—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∞–º–∏, –ø–∏—à–∏—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–æ–Ω–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `identity` transform.
-->

# Hidden Partitioning

–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ **–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**, –∞ –Ω–µ —Å—Ö–µ–º–∞.

<div style="display: flex; gap: 20px;">
<div style="flex: 1;">

### üê¢ Hive Style
```sql
CREATE TABLE logs (
  ts timestamp,
  ...
)
PARTITIONED BY (day_str string);

-- Query
SELECT * FROM logs
WHERE ts > '2024-02-01'
  AND day_str >= '2024-02-01';
-- üò´ –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å –ø—Ä–æ day_str!
```

</div>
<div style="flex: 1;">

### üßä Iceberg Style
```sql
CREATE TABLE logs (
  ts timestamp,
  ...
)
PARTITIONED BY (days(ts));

-- Query
SELECT * FROM logs
WHERE ts > '2024-02-01';

-- üòé Iceberg —Å–∞–º –ø–æ–π–º—ë—Ç,
-- –∫–∞–∫–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–∏—Ç–∞—Ç—å.
```

</div>
</div>

---

<!--
[–°–ª–∞–π–¥ 21]
Schema Evolution ‚Äî —ç—Ç–æ –±–æ–ª—å –≤ Hive.
–£–¥–∞–ª–∏–ª–∏ –∫–æ–ª–æ–Ω–∫—É –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ? –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–º–µ—Å—Ç–∏–ª–∏—Å—å.
–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏? Parquet –ø–æ—Ç–µ—Ä—è–ª —Å–≤—è–∑—å.

–í Iceberg –≤—Å—ë —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ **Unique Column IDs**.
–ò–º—è –∫–æ–ª–æ–Ω–∫–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —è—Ä–ª—ã–∫ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞.
–í–Ω—É—Ç—Ä–∏ Iceberg –æ–ø–µ—Ä–∏—Ä—É–µ—Ç ID: 1, 2, 3...

–ü—Ä–∏–º–µ—Ä:
–ë—ã–ª–æ: `1: id`, `2: data`.
–°–¥–µ–ª–∞–ª–∏ `RENAME data -> payload`.
–°—Ç–∞–ª–æ: `1: id`, `2: payload`.

–ö–æ–≥–¥–∞ –º—ã —á–∏—Ç–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª, –º—ã –∏—â–µ–º –≤ –Ω—ë–º –ø–æ–ª–µ —Å **ID=2**.
–ù–∞–º –Ω–µ –≤–∞–∂–Ω–æ, –∫–∞–∫ –æ–Ω–æ –Ω–∞–∑—ã–≤–∞–ª–æ—Å—å –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å `ADD`, `DROP`, `RENAME`, `REORDER` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: `metadata.json` —Ö—Ä–∞–Ω–∏—Ç **–∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö —Å—Ö–µ–º**.
–§–∞–π–ª A –º–æ–≥ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω —Å–æ —Å—Ö–µ–º–æ–π v1, –∞ —Ñ–∞–π–ª B ‚Äî —Å–æ —Å—Ö–µ–º–æ–π v2.
–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ Iceberg –ø—Ä–∏–≤–æ–¥–∏—Ç –≤—Å—ë –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ, –∏—Å–ø–æ–ª—å–∑—É—è ID –∫–æ–ª–æ–Ω–æ–∫.
-->

# –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã (Schema Evolution)

- **ID-based tracking**: –ö–æ–ª–æ–Ω–∫–∏ —Å–≤—è–∑–∞–Ω—ã –ø–æ ID, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏.
- **Instant Operations**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`metadata.json`).
- **Schema History**: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º. –†–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã.

```json
// Internal Schema Representation
{
  "type": "struct",
  "fields": [
    { "id": 1, "name": "id", "type": "int" },
    { "id": 2, "name": "data", "type": "string" }
  ]
}
```
*–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ `data` –≤ `payload` –Ω–µ –º–µ–Ω—è–µ—Ç ID=2.*

---

<!--
[–°–ª–∞–π–¥ 22]
Time Travel ‚Äî —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—à–ª–æ–µ.
–¢–∞–∫ –∫–∞–∫ Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Immutable** —Ñ–∞–π–ª—ã –∏ —Å–Ω–∞–ø—à–æ—Ç—ã, —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∏–∫—É–¥–∞ –Ω–µ –¥–µ–≤–∞—é—Ç—Å—è (–ø–æ–∫–∞ –≤—ã –∏—Ö –Ω–µ —É–¥–∞–ª–∏—Ç–µ —è–≤–Ω–æ).

–ú—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∑–∞—Ç—å: "–ü—Ä–æ—á–∏—Ç–∞–π —Ç–∞–±–ª–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ—Ä–µ–Ω—å –¥–µ—Ä–µ–≤–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞ #123".

–°—Ü–µ–Ω–∞—Ä–∏–∏:
1. **–ê—É–¥–∏—Ç**: –ö–∞–∫ –≤—ã–≥–ª—è–¥–µ–ª –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ 1 —è–Ω–≤–∞—Ä—è?
2. **–û—Ç–ª–∞–¥–∫–∞**: –í—á–µ—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω —É–ø–∞–ª. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –¥–∞–Ω–Ω—ã–µ "–∫–∞–∫ –≤—á–µ—Ä–∞".
3. **ML**: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏.

Q: –ò —á—Ç–æ, –¥–∞–Ω–Ω—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è? –ê –µ—Å–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è, —Ç–æ –∫–∞–∫ —è –º–æ–≥—É –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞—Ç –Ω–∞ —Ç–∞–∫—É—é-—Ç–æ –¥–∞—Ç—É?
A: –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π `expire_snapshots`.
–ü–æ–∫–∞ –≤—ã –µ—ë –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ ‚Äî –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤–µ—á–Ω–æ (–∏ –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ S3).
–û–±—ã—á–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç Retention Policy: –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é 7 –¥–Ω–µ–π.
–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞—Ç –Ω–∞ –≥–æ–¥ –Ω–∞–∑–∞–¥ (–¥–ª—è –∞—É–¥–∏—Ç–∞) ‚Äî –≤—ã –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏—Ç–µ retention 365 –¥–Ω–µ–π.
-->

# Time Travel

–ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

```sql
-- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
SELECT * FROM events
FOR SYSTEM_TIME AS OF '2024-02-01 12:00:00';

-- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–Ω–∞–ø—à–æ—Ç—É (–ø–æ ID)
SELECT * FROM events
FOR SYSTEM_VERSION AS OF 83627462847462;
```

### üõ† Use Cases:
- **Audit**: "–ß—Ç–æ –±—ã–ª–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥?"
- **Rollback**: "–û—Ç–∫–∞—Ç–∏—Ç—å –ø–ª–æ—Ö–æ–π –¥–µ–ø–ª–æ–π –¥–∞–Ω–Ω—ã—Ö".
- **Reproducible ML**: "–û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏".

---

<!--
[–°–ª–∞–π–¥ 23]
Iceberg ‚Äî —ç—Ç–æ –Ω–µ –º–∞–≥–∏—è. –ó–∞ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –Ω—É–∂–Ω–æ —É—Ö–∞–∂–∏–≤–∞—Ç—å.
–ï—Å–ª–∏ –≤—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∏—à–µ—Ç–µ –º–µ–ª–∫–∏–µ —Ñ–∞–π–ª—ã (Streaming), —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —É –≤–∞—Å –±—É–¥–µ—Ç –º–∏–ª–ª–∏–æ–Ω —Ñ–∞–π–ª–æ–≤ –∏ —Ç–æ—Ä–º–æ–∑–∞.

–¢—Ä–∏ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:
1. **Compaction**: –ë–µ—Ä—ë–º –∫—É—á—É –º–µ–ª–∫–∏—Ö —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –≤ –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π. –≠—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–∑–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Å–Ω–∞–ø—à–æ—Ç–µ).
2. **Expire Snapshots**: –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏. –ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å –¥–∏—Å–∫–∞.
3. **Orphan Files**: –°–±–æ—Ä –º—É—Å–æ—Ä–∞. –ï—Å–ª–∏ Spark —É–ø–∞–ª –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ –∑–∞–ø–∏—Å–∏, –æ–Ω –º–æ–≥ –æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã. –≠—Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∏—Ö –Ω–∞–π–¥—ë—Ç –∏ —É–¥–∞–ª–∏—Ç.
-->

# –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (Maintenance)

–¢–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±—É—é—Ç —É—Ö–æ–¥–∞, –∏–Ω–∞—á–µ –æ–Ω–∏ –¥–µ–≥—Ä–∞–¥–∏—Ä—É—é—Ç.

### 1. Compaction (Small Files Problem)
```sql
CALL catalog.system.rewrite_data_files(table => 'db.logs');
```
*–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç 1000 –º–µ–ª–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ 1 –±–æ–ª—å—à–æ–π.*

### 2. Expire Snapshots (Vacuum)
```sql
CALL catalog.system.expire_snapshots(
  table => 'db.logs',
  older_than => TIMESTAMP '...'
);
```
*–£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–æ –Ω–∞ S3.*

### 3. Remove Orphan Files (GC)
*–£–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä –æ—Ç —É–ø–∞–≤—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.*

---

<!--
[–°–ª–∞–π–¥ 24]
–•–≤–∞—Ç–∏—Ç —Ç–µ–æ—Ä–∏–∏. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª—ã.
–Ø –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PyIceberg ‚Äî —ç—Ç–æ –Ω–∞—Ç–∏–≤–Ω—ã–π Python-–∫–ª–∏–µ–Ω—Ç.
–ú—ã —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –ª–æ–∫–∞–ª—å–Ω–æ –∏ –±—É–¥–µ–º —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ JSON-—Ñ–∞–π–ª—ã —Å–≤–æ–∏–º–∏ –≥–ª–∞–∑–∞–º–∏.

–ü–ª–∞–Ω –¥–µ–º–æ:
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É.
2. –ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
3. –ù–∞–π—Ç–∏ Metadata File, Manifest List, Manifest File.
4. –°–¥–µ–ª–∞—Ç—å Time Travel.
-->

# –î–µ–º–æ: –ê–Ω–∞—Ç–æ–º–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

üõ† **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: PyIceberg + DuckDB

### –°—Ü–µ–Ω–∞—Ä–∏–π:
1. **Init**: –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É `taxi_dataset`.
2. **Inspect**: –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (`metadata/`, `data/`).
3. **Append**: –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ, –≤–∏–¥–∏–º –Ω–æ–≤—ã–π —Å–Ω–∞–ø—à–æ—Ç.
4. **Time Travel**: –ß–∏—Ç–∞–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é.
5. **Pruning**: –°–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –æ—Ç—Å–µ–∫–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã.

> üë®‚Äçüíª –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª...

---

<!--
[–°–ª–∞–π–¥ 25]
–ü–æ–¥–≤–µ–¥—ë–º –∏—Ç–æ–≥–∏.
Iceberg ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤, —ç—Ç–æ **Table Format**.
–û–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (ACID, Transactions) –≤ –º–∏—Ä —Ñ–∞–π–ª–æ–≤ (S3/Parquet).

–ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å:
1. –í—Å—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –≤ –¥–µ—Ä–µ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî —ç—Ç–æ —Ä–∞–±–æ—Ç–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, –∞ –Ω–µ –ª–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤.
3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞—é—Ç—Å—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ (OCC).
-->

# –ò—Ç–æ–≥–∏

Apache Iceberg –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Data Lake –≤ Data Warehouse.

1. **Metadata Tree**: `Snapshot` &rarr; `Manifest List` &rarr; `Manifest` &rarr; `Data`.
2. **Performance**: Pruning –æ—Ç—Å–µ–∫–∞–µ—Ç 99% —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
3. **Reliability**: ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, Safe Schema Evolution.
4. **Usability**: Hidden Partitioning, Time Travel.

### üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- üìÑ **Spec**: iceberg.apache.org/spec (—á–∏—Ç–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ!)
- üêô **Code**: github.com/apache/iceberg

--- 

<!--
[–°–ª–∞–π–¥ 26]
–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.
-->

# –í–æ–ø—Ä–æ—Å—ã?
