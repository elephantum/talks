---
marp: true
html: true
theme: default
paginate: true
title: Apache Iceberg –∏–∑–Ω—É—Ç—Ä–∏ (Bottom-Up)
---

<!--
[–°–ª–∞–π–¥ 1]
–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ Apache Iceberg ‚Äî –Ω–æ –Ω–µ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞ –∑–∞–≥–ª—è–Ω–µ–º –ø–æ–¥ –∫–∞–ø–æ—Ç. –†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å, –∏ –ø–æ—á–µ–º—É Iceberg –¥–∞—ë—Ç ACID-–≥–∞—Ä–∞–Ω—Ç–∏–∏. –≠—Ç–æ –±—É–¥–µ—Ç —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–∫–ª–∞–¥, —Ç–∞–∫ —á—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å.

ACID:
- Atomicity (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º, –ª–∏–±–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–≤—Å–µ.
- Consistency (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥—Ä—É–≥–æ–µ.
- Isolation (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å): –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞.
- Durability (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å): –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.
-->

# Apache Iceberg –∏–∑–Ω—É—Ç—Ä–∏
## –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

–†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω Iceberg –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º: –æ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ ACID-–≥–∞—Ä–∞–Ω—Ç–∏–π.

---

<!--
[–°–ª–∞–π–¥ 2]
–û–±–æ –º–Ω–µ: –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–∏–∫–µ—Ä–µ, –µ–≥–æ –æ–ø—ã—Ç–µ –∏ —Ç–µ–∫—É—â–µ–π —Ä–æ–ª–∏.
-->

# –û–±–æ –º–Ω–µ

## –ê–Ω–¥—Ä–µ–π –¢–∞—Ç–∞—Ä–∏–Ω–æ–≤

- –õ—é–±–ª—é —É–∑–Ω–∞–≤–∞—Ç—å –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–∏—Ä –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–± —ç—Ç–æ–º
- Founder Epoch8 - –∑–∞–∫–∞–∑–Ω–∞—è ML-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- ex-Google, ex-Yandex

---

<!--
[–°–ª–∞–π–¥ 3]
–ü–ª–∞–Ω —É –Ω–∞—Å —Ç–∞–∫–æ–π.
–°–Ω–∞—á–∞–ª–∞ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ –±–æ–ª–∏. –ü–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –¥–æ–±—Ä—ã–π Hive Metastore –∏ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞ S3 –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –Ω–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å.
–ó–∞—Ç–µ–º —Ä–∞–∑–±–µ—Ä—ë–º –∞–Ω–∞—Ç–æ–º–∏—é Iceberg. –í —ç—Ç–æ—Ç —Ä–∞–∑ –º—ã –ø–æ–π–¥–µ–º –°–ù–ò–ó–£ –í–í–ï–†–•. –û—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –º—ã –±—É–¥–µ–º —Å—Ç—Ä–æ–∏—Ç—å —Å–ª–æ–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
–ü–æ—Ç–æ–º –ø–µ—Ä–µ–π–¥—ë–º –∫ –¥–∏–Ω–∞–º–∏–∫–µ: –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å.
–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∏: Time Travel, —ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º—ã –∏ —Å–∫—Ä—ã—Ç–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
–ò –≤ –∫–æ–Ω—Ü–µ ‚Äî –¥–µ–º–æ.
-->

# –û —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏–º

1. **–ë–æ–ª—å**: –ü–æ—á–µ–º—É Hive-—Ç–∞–±–ª–∏—Ü—ã –ª–æ–º–∞—é—Ç—Å—è –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö (Data -> Catalog)
3. **–ú–µ—Ö–∞–Ω–∏–∫–∞**: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Read, Write –∏ ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. **–§–∏—á–∏**: Time Travel, Schema Evolution, Hidden Partitioning
5. **–ü—Ä–∞–∫—Ç–∏–∫–∞**: –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª—ã —Ä—É–∫–∞–º–∏ —á–µ—Ä–µ–∑ PyIceberg + DuckDB

---

<!--
[–°–ª–∞–π–¥ 4]
–ù–∞—á–Ω—ë–º —Å –ø—Ä–æ–±–ª–µ–º—ã. –ö–∞–∫ –º—ã –ø—Ä–∏–≤—ã–∫–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–µ—Ç? Hive-style —Ç–∞–±–ª–∏—Ü—ã.
–≠—Ç–æ –ø–æ —Å—É—Ç–∏ –ø—Ä–æ—Å—Ç–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.
–ó–≤—É—á–∏—Ç –ø—Ä–æ—Å—Ç–æ, –Ω–æ –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ (PB –¥–∞–Ω–Ω—ã—Ö) —ç—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞.

1. **O(N) Listing**: –ß—Ç–æ–±—ã —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤. –ù–∞ S3 —ç—Ç–æ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ.
2. **–ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**: –ï—Å–ª–∏ ETL —É–ø–∞–ª –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ, —á–∏—Ç–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç "–≥—Ä—è–∑–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ.
3. **S3 Rename**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ –æ–±–ª–∞–∫–µ ‚Äî —ç—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ + —É–¥–∞–ª–µ–Ω–∏–µ. –î–æ—Ä–æ–≥–æ –∏ –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω–æ.
4. **–ñ–µ—Å—Ç–∫–æ—Å—Ç—å**: –°–º–µ–Ω–∞ —Å—Ö–µ–º—ã –∏–ª–∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö.
-->

# –ü—Ä–æ–±–ª–µ–º–∞: Hive-—Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –º–∞—Å—à—Ç–∞–±–µ

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥: `.../table/date=2024-01-01/*.parquet`

1. **üê¢ O(N) Listing**: –ß—Ç–æ–±—ã —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `ls -R`. –ù–∞ S3 —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω—É—Ç—ã.
2. **üí• –ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**: Job —É–ø–∞–ª –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ –∑–∞–ø–∏—Å–∏? –ß–∏—Ç–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ ("–≥—Ä—è–∑–Ω—ã–µ") –¥–∞–Ω–Ω—ã–µ.
3. **‚òÅÔ∏è S3 Rename**: –í –æ–±–ª–∞–∫–∞—Ö –Ω–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ `rename`. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ = `copy` + `delete` –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤. –≠—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –¥–æ—Ä–æ–≥–æ.
4. **üóø –ñ–µ—Å—Ç–∫–æ—Å—Ç—å**: –°–º–µ–Ω–∞ —Å—Ö–µ–º—ã –∏–ª–∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –±–æ–ª—å. –ß–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö (Restatement).

---

<!--
[–°–ª–∞–π–¥ 5]
Iceberg ‚Äî —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã. –≠—Ç–æ **Open Table Format**.

1. **–≠—Ç–æ –Ω–µ —Ñ–∞–π–ª–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç**: Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Parquet, ORC, Avro.
2. **–≠—Ç–æ –Ω–µ –¥–≤–∏–∂–æ–∫**: Iceberg ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞. –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ Spark, Trino, Flink, DuckDB.
3. **–≠—Ç–æ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°—Ç–∞–Ω–¥–∞—Ä—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ACID-–≥–∞—Ä–∞–Ω—Ç–∏–π.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: Delta Lake, Apache Hudi.
-->

# –†–µ—à–µ–Ω–∏–µ: Open Table Format

Iceberg ‚Äî —ç—Ç–æ **–æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**.

- **–ù–µ —Ñ–∞–π–ª–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Parquet/ORC/Avro –¥–ª—è –¥–∞–Ω–Ω—ã—Ö.
- **–ù–µ –¥–≤–∏–∂–æ–∫**: –†–∞–±–æ—Ç–∞–µ—Ç —Å Spark, Trino, Flink, DuckDB.
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –û–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ —Ç–∞–±–ª–∏—Ü—É —Å ACID-–≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏.

> **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**: Delta Lake (Databricks), Apache Hudi (Uber).

---

<!--
[–°–ª–∞–π–¥ 6]
–í —á—ë–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ?
Hive: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã = —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏).
Iceberg: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã = —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

–ú—ã –ø–µ—Ä–µ—Å—Ç–∞—ë–º —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ù–∞–º –≤—Å—ë —Ä–∞–≤–Ω–æ, –≥–¥–µ –ª–µ–∂–∞—Ç —Ñ–∞–π–ª—ã.
–ì–ª–∞–≤–Ω–æ–µ ‚Äî —ç—Ç–æ **Manifest**, —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤.
–≠—Ç–æ –¥–∞—ë—Ç O(1) –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (–ø–æ–¥–º–µ–Ω–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤).
-->

# –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è: –§–∞–π–ª—ã, –∞ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

Hive: "–ß—Ç–æ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ ‚Äî —Ç–æ –∏ —Ç–∞–±–ª–∏—Ü–∞"
Iceberg: "–ß—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ —Å–ø–∏—Å–∫–µ ‚Äî —Ç–æ –∏ —Ç–∞–±–ª–∏—Ü–∞"

- **–û—Ç–≤—è–∑–∫–∞ –æ—Ç FS**: –§–∞–π–ª—ã –º–æ–≥—É—Ç –ª–µ–∂–∞—Ç—å –≥–¥–µ —É–≥–æ–¥–Ω–æ.
- **–¢–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫**: –ú—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞.
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ —Ö—Ä–∞–Ω–∏–º `min/max`, `null count`, `row count`.

---

<!--
[–°–ª–∞–π–¥ 7]
–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –∞–Ω–∞—Ç–æ–º–∏—é Iceberg. –ò —Å–æ–±–µ—Ä–µ–º –µ–µ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–∞–∂–¥—ã–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª–æ–π.
–ú—ã –Ω–∞—á–Ω–µ–º —Å –¥–∞–Ω–Ω—ã—Ö –∏ –±—É–¥–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ª–æ–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, —Ä–µ—à–∞—è –ø–æ –æ–¥–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ –∑–∞ —Ä–∞–∑.

–°–ª–æ–π 1: –î–∞–Ω–Ω—ã–µ.
–°–ª–æ–π 2: –ö–∞–∫ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ? (Manifest)
–°–ª–æ–π 3: –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—á–µ–π –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤? (Manifest List)
–°–ª–æ–π 4: –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ —Å—Ö–µ–º—É? (Metadata File)
–°–ª–æ–π 5: –ì–¥–µ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞? (Catalog)
-->

# –ê–Ω–∞—Ç–æ–º–∏—è: –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö

–ú—ã –ø—Ä–æ–π–¥—ë–º –ø—É—Ç—å –æ—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

1. **Data Layer**: –î–∞–Ω–Ω—ã–µ –∏ —É–¥–∞–ª–µ–Ω–∏—è.
2. **Index Layer**: Manifest Files.
3. **Snapshot Layer**: Manifest List.
4. **Metadata Layer**: Metadata File.
5. **Pointer Layer**: Catalog.

---

<!--
[–°–ª–∞–π–¥ 8]
–°–ª–æ–π 1: **Data & Delete Files**.
–í —Å–∞–º–æ–º –Ω–∏–∑—É –ª–µ–∂–∞—Ç –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã: Parquet, ORC, Avro. –≠—Ç–æ –Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.

–ù–æ —á—Ç–æ –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É? –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª –¥–æ—Ä–æ–≥–æ.
–í Iceberg v2 –ø–æ—è–≤–∏–ª–∏—Å—å **Delete Files**.
–ú—ã –ø–∏—à–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç: "–°—Ç—Ä–æ–∫–∞ X –≤ —Ñ–∞–π–ª–µ Y —É–¥–∞–ª–µ–Ω–∞".
–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–≤–∏–∂–æ–∫ –¥–µ–ª–∞–µ—Ç Merge-On-Read: —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã—á–∏—Ç–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è.

–ü—Ä–æ–±–ª–µ–º–∞ —ç—Ç–æ–≥–æ —Å–ª–æ—è: –£ –Ω–∞—Å –µ—Å—Ç—å –∫—É—á–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ S3. –ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –Ω–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ? `ls` –¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è (–¥–æ—Ä–æ–≥–æ).
-->

# –°–ª–æ–π 1: Data & Delete Files

–§—É–Ω–¥–∞–º–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã.

**Data Files**: –û–±—ã—á–Ω—ã–µ Parquet/ORC —Ñ–∞–π–ª—ã.
**Delete Files** (Merge-On-Read):
  - **Position Deletes**: "–£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ ‚Ññ100 –≤ —Ñ–∞–π–ª–µ A".
  - **Equality Deletes**: "–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ id=5".


> **–ü—Ä–æ–±–ª–µ–º–∞**: –§–∞–π–ª–æ–≤ —Ç—ã—Å—è—á–∏. –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Ñ–∞–π–ª—ã —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ç–∞–±–ª–∏—Ü—É, –Ω–µ –¥–µ–ª–∞—è –º–µ–¥–ª–µ–Ω–Ω—ã–π `ls`?

---

<!--
[–°–ª–∞–π–¥ 9]
–°–ª–æ–π 2: **Manifest File**.
–†–µ—à–µ–Ω–∏–µ: –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª-—Å–ø–∏—Å–æ–∫!
–ú–∞–Ω–∏—Ñ–µ—Å—Ç ‚Äî —ç—Ç–æ —Ñ–∞–π–ª (Avr–æ), –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –¥–∞–Ω–Ω—ã—Ö.

–ù–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫. –≠—Ç–æ **–∏–Ω–¥–µ–∫—Å**.
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –º—ã —Ö—Ä–∞–Ω–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
- Row count
- Min/Max –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ (–¥–ª—è –æ—Ç—Å–µ—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏)
- Partition data

–¢–µ–ø–µ—Ä—å –º—ã –∑–Ω–∞–µ–º, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —á–∏—Ç–∞—Ç—å.
–ù–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Ç–µ—Ç. –ú–∞–Ω–∏—Ñ–µ—Å—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–º. –ò–ª–∏ —É –Ω–∞—Å —Ç—ã—Å—è—á–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å). –ö–∞–∫ –∏–º–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å?
-->

# –°–ª–æ–π 2: Manifest File (`manifest.avro`)

**–†–µ—à–µ–Ω–∏–µ**: –§–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ Data Files.

- **–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤**: `s3://.../data-a.parquet`, `s3://.../data-b.parquet`
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (Index)**:
    - `row_count`: 10000
    - `lower_bounds`: `{id: 100}`
    - `upper_bounds`: `{id: 500}`
- **Partition Data**: –ö –∫–∞–∫–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ñ–∞–π–ª.

> **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –º—ã —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã. –ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∏—Ö –≤–º–µ—Å—Ç–µ –≤ –µ–¥–∏–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã?

---

<!--
[–°–ª–∞–π–¥ 10]
–°–ª–æ–π 3: **Manifest List**.
–†–µ—à–µ–Ω–∏–µ: –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Å–ø–∏—Å–æ–∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤!
–≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Manifest List**. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–°–Ω–∞–ø—à–æ—Ç** (Snapshot) ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

Manifest List —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∏–Ω–¥–µ–∫—Å.
–û–Ω —Ö—Ä–∞–Ω–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞.
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏—â–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ "2024-02-01", –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –≤ Manifest List –∏ —Å—Ä–∞–∑—É –æ—Ç–±—Ä–æ—Å–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∑–∞ –Ø–Ω–≤–∞—Ä—å.

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å —Å–Ω–∞–ø—à–æ—Ç.
–ù–æ –ø—Ä–æ–±–ª–µ–º–∞: –¢–∞–±–ª–∏—Ü–∞ –º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –°—Ö–µ–º—ã –º–µ–Ω—è—é—Ç—Å—è. –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –∏ —ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º—ã?
-->

# –°–ª–æ–π 3: Manifest List (`snap-123.avro`)

**–†–µ—à–µ–Ω–∏–µ**: –§–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –≤ **–°–Ω–∞–ø—à–æ—Ç**.

- **Snapshot**: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ T.
- **Partition Pruning**: –•—Ä–∞–Ω–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞.
    - *–ü—Ä–∏–º–µ—Ä*: "–í `manifest-a` –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∑–∞ –Ø–Ω–≤–∞—Ä—å".

> **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π (v1, v2, v3)? –ö–∞–∫ –º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã?

---

<!--
[–°–ª–∞–π–¥ 11]
–°–ª–æ–π 4: **Metadata File**.
–†–µ—à–µ–Ω–∏–µ: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã ‚Äî `metadata.json`.
–≠—Ç–æ "–º–æ–∑–≥" —Ç–∞–±–ª–∏—Ü—ã.

–ß—Ç–æ –æ–Ω —Ö—Ä–∞–Ω–∏—Ç:
1. **Schemas**: –ò—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö —Å—Ö–µ–º.
2. **Partition Specs**: –ò—Å—Ç–æ—Ä–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
3. **Snapshots**: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–Ω–∞–ø—à–æ—Ç–æ–≤ (–∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤).
4. **Current Snapshot ID**: –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç.

–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–´–ô —Ñ–∞–π–ª metadata.json (v1, v2...).

–û—Å—Ç–∞–ª–∞—Å—å –ø–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞: –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (Spark/Trino) –Ω–∞–π—Ç–∏ —ç—Ç–æ—Ç `metadata.json`? –ò –∫–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –∞—Ç–æ–º–∞—Ä–Ω–æ?
-->

# –°–ª–æ–π 4: Metadata File (`v2.metadata.json`)

**–†–µ—à–µ–Ω–∏–µ**: JSON-—Ñ–∞–π–ª, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ç–∞–±–ª–∏—Ü—É —Ü–µ–ª–∏–∫–æ–º.

- **Schemas**: –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã.
- **Partition Specs**: –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
- **Snapshots**: –õ–æ–≥ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π —Ç–∞–±–ª–∏—Ü—ã (`s1`, `s2`, `s3`...).
- **Current Snapshot**: –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π Manifest List.

> **–ü—Ä–æ–±–ª–µ–º–∞**: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ *—Ç–µ–∫—É—â–∏–π* metadata.json? –ö–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å –µ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ (ACID)?

---

<!--
[–°–ª–∞–π–¥ 12]
–°–ª–æ–π 5: **Catalog**.
–†–µ—à–µ–Ω–∏–µ: –í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ—Ä–∂–∏—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ç–µ–∫—É—â–∏–π metadata.json.
–≠—Ç–æ –≤–µ—Ä—à–∏–Ω–∞ –Ω–∞—à–µ–π –ø–∏—Ä–∞–º–∏–¥—ã.

–ö–∞—Ç–∞–ª–æ–≥ –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å **CAS (Compare-And-Swap)**.
–û–ø–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–∏—Ç–∞: "–û–±–Ω–æ–≤–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ `v2.metadata.json`, –¢–û–õ–¨–ö–û –ï–°–õ–ò —Å–µ–π—á–∞—Å –æ–Ω —Ä–∞–≤–µ–Ω `v1.metadata.json`".
–ò–º–µ–Ω–Ω–æ —ç—Ç–æ –¥–∞–µ—Ç –Ω–∞–º ACID –∏ –ª–∏–Ω–µ–∞—Ä–∏–∑—É–µ–º–æ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏.

–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏: Hive Metastore, REST Catalog, AWS Glue.
-->

# –°–ª–æ–π 5: Catalog

**–†–µ—à–µ–Ω–∏–µ**: –ê—Ç–æ–º–∞—Ä–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å.

- **–ó–∞–¥–∞—á–∞**: –•—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ `current metadata location`.
- **ACID –º–µ—Ö–∞–Ω–∏–∑–º**: `Compare-And-Swap` (CAS).
    - *Swap(Table, Expected=v1, New=v2)*
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
    - üêò Hive Metastore
    - ‚òÅÔ∏è AWS Glue
    - üåê REST Catalog

> ‚úÖ **–ò—Ç–æ–≥**: –ú—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç ACID –∏ O(1) –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º.

---

<!--
[–°–ª–∞–π–¥ 13]
–ü—Ä–µ–∂–¥–µ —á–µ–º –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ, –¥–∞–≤–∞–π—Ç–µ —É–≥–ª—É–±–∏–º—Å—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
–í Iceberg —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫, –∞ –ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.
–ú—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º Partition Spec ‚Äî –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–æ–ª–æ–Ω–æ–∫.
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π Pruning (–æ—Ç—Å–µ—á–µ–Ω–∏–µ) –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
-->

# –î–µ—Ç–∞–ª—å–Ω–µ–µ –ø—Ä–æ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–∞–∫ Iceberg –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ?

* **Partition Spec**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è, –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö.
* **Transforms** (—Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è): `identity(category)`, `bucket(16, user_id)`,`truncate(4, name)`, `year/month/day/hour(ts)`

> üí° **–í–∞–∂–Ω–æ**:
> - **–ò–∑–æ–ª—è—Ü–∏—è**: –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π **–≤—Å–µ–≥–¥–∞** –ª–µ–∂–∞—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.
> - **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã**: –ü–∞—Ä—Ç–∏—Ü–∏–∏ ‚Äî –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–æ–ª—è—Ü–∏–∏. –ó–∞–ø–∏—Å—å –≤ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç.
> - **–ò–Ω–¥–µ–∫—Å**: –ó–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞—Ö (Pruning –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö).

---

<!--
[–°–ª–∞–π–¥ 14]
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–∏–Ω–∞–º–∏–∫–µ.
–ß—Ç–µ–Ω–∏–µ (Read Path).
-->

# –ò –∫–∞–∫ —Å —ç—Ç–∏–º –≤—Å–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å?

---

<!--
[–°–ª–∞–π–¥ 15]
–ü–µ—Ä–≤—ã–π —à–∞–≥ —á—Ç–µ–Ω–∏—è ‚Äî **Snapshot Isolation**.
–î—Ä–∞–π–≤–µ—Ä –∏–¥–µ—Ç –≤ Catalog -> Metadata File -> Current Snapshot.
–û–Ω —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç ID —Å–Ω–∞–ø—à–æ—Ç–∞.
–í—Å—ë, —Å —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º–∏—Ä –∑–∞–º–µ—Ä. –õ—é–±—ã–µ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –Ω–∞—Å –Ω–µ –∫–∞—Å–∞—é—Ç—Å—è.
–ú—ã –ø–æ–ª—É—á–∏–ª–∏ Repeatable Reads.
-->

# –ü—É—Ç—å —á—Ç–µ–Ω–∏—è: Snapshot Isolation

1. **Load Metadata**: –ß–∏—Ç–∞–µ–º `metadata.json` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.
2. **Pick Snapshot**: –§–∏–∫—Å–∏—Ä—É–µ–º `current-snapshot-id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `s3`).
3. **Ignore Updates**: –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã (`s4`, `s5`) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

> üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.

---

<!--
[–°–ª–∞–π–¥ 16]
–î–∞–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç **Pruning** (–æ—Ç—Å–µ—á–µ–Ω–∏–µ).
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à–∏ –∏–Ω–¥–µ–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å—Ç—Ä–æ–∏–ª–∏ (Manifest List –∏ Manifest File).

1. **Manifest List**: –û—Ç—Å–µ–∫–∞–µ–º —Ü–µ–ª—ã–µ –≥—Ä—É–ø–ø—ã —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º (–¥–∞—Ç–∞–º).
2. **Manifest File**: –û—Ç—Å–µ–∫–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–π –ø–æ min/max —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–ª–æ–Ω–æ–∫.

–í –∏—Ç–æ–≥–µ –∏–∑ –ø–µ—Ç–∞–±–∞–π—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –º—ã —á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –≥–∏–≥–∞–±–∞–π—Ç—ã.
-->

# Pruning: –ò–µ—Ä–∞—Ä—Ö–∏—è –æ—Ç—Å–µ—á–µ–Ω–∏—è

–ö–∞–∫ –Ω–∞–π—Ç–∏ –∏–≥–æ–ª–∫—É –≤ —Å—Ç–æ–≥–µ —Å–µ–Ω–∞ (–±—ã—Å—Ç—Ä–æ):

1. **Partition Pruning** (Manifest List):
   - –û—Ç—Å–µ–∫–∞–µ–º **–≥—Ä—É–ø–ø—ã —Ñ–∞–π–ª–æ–≤** –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –ø–∞—Ä—Ç–∏—Ü–∏–π.
   - `date` in [2024-01-01, 2024-01-31] ‚ùå

2. **Min/Max Filtering** (Manifest File):
   - –û—Ç—Å–µ–∫–∞–µ–º **–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–ª–æ–Ω–æ–∫.
   - `id` in [0, 100] ‚ùå

> üìâ Scan Planning –æ—Ç—Å–µ–∫–∞–µ—Ç 99% –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

---

<!--
[–°–ª–∞–π–¥ 17]
–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –ª–∏—Å—Ç–∏–Ω–≥–∞ S3.
–ú—ã –ø—Ä–æ—Å—Ç–æ –∏–¥–µ–º –ø–æ –¥–µ—Ä–µ–≤—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
Metadata -> Manifest List -> Manifests -> Tasks.
–≠—Ç–æ –±—ã—Å—Ç—Ä–æ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ.
-->

# Scan Planning

–ö–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å SQL –≤ –ø–ª–∞–Ω –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è?

1. **Metadata Traversal**: –ß–∏—Ç–∞–µ–º Snapshot &rarr; Manifest List &rarr; Manifests.
2. **Filtering**: –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–µ–¥–∏–∫–∞—Ç—ã (Pruning) –Ω–∞ –ª–µ—Ç—É.
3. **Split Generation**: –°–æ–∑–¥–∞—ë–º –∑–∞–¥–∞—á–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è (Tasks).

üöÄ **–ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–æ?**
- **No File Listing**: –ù–∏–∫–∞–∫–∏—Ö `ls` –ø–æ S3.
- **O(Metadata)**, –∞ –Ω–µ O(Data).

---

<!--
[–°–ª–∞–π–¥ 18]
–¢–µ–ø–µ—Ä—å –∑–∞–ø–∏—Å—å (Write Path).
–ó–¥–µ—Å—å –º—ã —Ç–æ–∂–µ –∏–¥–µ–º —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö, –∫–∞–∫ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∞–Ω–∞—Ç–æ–º–∏–∏!
1. –ü–∏—à–µ–º –¥–∞–Ω–Ω—ã–µ (Data Files).
2. –ü–∏—à–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã (Manifest Files).
3. –ü–∏—à–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Metadata File).
4. –î–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.
-->

# –ü—É—Ç—å –∑–∞–ø–∏—Å–∏: –ê–Ω–∞—Ç–æ–º–∏—è –∫–æ–º–º–∏—Ç–∞

![h:500](diagrams/commit.svg)

---

<!--
[–°–ª–∞–π–¥ 19]
Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Optimistic Concurrency Control (OCC)**.
–ú—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É. –ú—ã –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ –±—É–¥–µ—Ç.
–ï—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–ª—É—á–∏–ª—Å—è (CAS –Ω–µ –ø—Ä–æ—à–µ–ª) ‚Äî –º—ã –¥–µ–ª–∞–µ–º retry.
-->

# Optimistic Concurrency Control

![OCC](diagrams/occ.svg)

1. **No Locks**: –ü–∏—Å–∞—Ç–µ–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
2. **Retry Loop**: –ï—Å–ª–∏ CAS –Ω–µ –ø—Ä–æ—à—ë–ª, –º—ã –Ω–µ –ø–∞–¥–∞–µ–º, –∞ –ø—ã—Ç–∞–µ–º—Å—è —Å–Ω–æ–≤–∞.
3. **Conflict Resolution**: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã –ª–∏ –Ω–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —á—É–∂–∏–º–∏.

---

<!--
[–°–ª–∞–π–¥ 20]
–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞—é—Ç—Å—è —É–º–Ω–æ.
–ï—Å–ª–∏ —è –¥–æ–±–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –∑–∞ —è–Ω–≤–∞—Ä—å, –∞ –∫–æ–ª–ª–µ–≥–∞ –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å ‚Äî —ç—Ç–æ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
–ï—Å–ª–∏ —è –¥–µ–ª–∞—é Append, –∞ –∫–æ–ª–ª–µ–≥–∞ Compaction ‚Äî —ç—Ç–æ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
–ö–æ–Ω—Ñ–ª–∏–∫—Ç ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º—ã –º–µ–Ω—è–µ–º –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª—è–µ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª).
-->

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

–ù–µ –≤—Å–µ –∫–æ–ª–ª–∏–∑–∏–∏ —Ñ–∞—Ç–∞–ª—å–Ω—ã. Iceberg –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π.

| –ú–æ—è –æ–ø–µ—Ä–∞—Ü–∏—è | –ß—É–∂–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è | –†–µ–∑—É–ª—å—Ç–∞—Ç |
| :--- | :--- | :--- |
| **Append** (Part A) | **Append** (Part B) | ‚úÖ Success (Rebase) |
| **Append** (Part A) | **Compaction** (Part B) | ‚úÖ Success |
| **Update** (File X) | **Delete** (File X) | ‚ùå Conflict |
| **Delete** (File X) | **Delete** (File X) | ‚ùå Conflict |

> üí° **Isolation Level**: Serializable / Snapshot Isolation.

---

<!--
[–°–ª–∞–π–¥ 21]
–ù–µ–º–Ω–æ–≥–æ –ø—Ä–æ –∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∏.
**Hidden Partitioning**.
–í Iceberg –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `days(ts)`, –∞ –Ω–µ –∫–æ–ª–æ–Ω–∫–∞ `day_str`.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ `ts`, –∞ Iceberg —Å–∞–º –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏.
–≠—Ç–æ —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –æ—à–∏–±–æ–∫ –∏ Full Table Scan.
-->

# Hidden Partitioning

–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ **–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**, –∞ –Ω–µ —Å—Ö–µ–º–∞.

<div style="display: flex; gap: 20px;">
<div style="flex: 1;">

### üê¢ Hive Style
```sql
CREATE TABLE logs (
  ts timestamp,
  ...
)
PARTITIONED BY (day_str string);

-- Query
SELECT * FROM logs
WHERE ts > '2024-02-01'
  AND day_str >= '2024-02-01';
-- üò´ –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å –ø—Ä–æ day_str!
```

</div>
<div style="flex: 1;">

### üßä Iceberg Style
```sql
CREATE TABLE logs (
  ts timestamp,
  ...
)
PARTITIONED BY (days(ts));

-- Query
SELECT * FROM logs
WHERE ts > '2024-02-01';

-- üòé Iceberg —Å–∞–º –ø–æ–π–º—ë—Ç,
-- –∫–∞–∫–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–∏—Ç–∞—Ç—å.
```

</div>
</div>

---

<!--
[–°–ª–∞–π–¥ 22]
**Schema Evolution**.
Iceberg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ID –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫, –∞ –Ω–µ –∏–º–µ–Ω–∞.
–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏, –º–µ–Ω—è—Ç—å –∏—Ö –ø–æ—Ä—è–¥–æ–∫, —É–¥–∞–ª—è—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å ‚Äî –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
–ò—Å—Ç–æ—Ä–∏—è —Å—Ö–µ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ metadata.json.
-->

# –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã (Schema Evolution)

- **ID-based tracking**: –ö–æ–ª–æ–Ω–∫–∏ —Å–≤—è–∑–∞–Ω—ã –ø–æ ID, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏.
- **Instant Operations**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
- **Schema History**: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º.

```json
// Internal Schema Representation
{
  "type": "struct",
  "fields": [
    { "id": 1, "name": "id", "type": "int" },
    { "id": 2, "name": "data", "type": "string" }
  ]
}
```
*–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ `data` –≤ `payload` –Ω–µ –º–µ–Ω—è–µ—Ç ID=2.*

---

<!--
[–°–ª–∞–π–¥ 23]
**Time Travel**.
–¢–∞–∫ –∫–∞–∫ –º—ã —Ö—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∞–ø—à–æ—Ç–æ–≤, –º—ã –º–æ–∂–µ–º —á–∏—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É "–∫–∞–∫ –æ–Ω–∞ –±—ã–ª–∞ –≤—á–µ—Ä–∞".
–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞—É–¥–∏—Ç–∞, –æ—Ç–ª–∞–¥–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–≥–æ ML.
-->

# Time Travel

–ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

```sql
-- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
SELECT * FROM events
FOR SYSTEM_TIME AS OF '2024-02-01 12:00:00';

-- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–Ω–∞–ø—à–æ—Ç—É (–ø–æ ID)
SELECT * FROM events
FOR SYSTEM_VERSION AS OF 83627462847462;
```

### üõ† Use Cases:
- **Audit**: "–ß—Ç–æ –±—ã–ª–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥?"
- **Rollback**: "–û—Ç–∫–∞—Ç–∏—Ç—å –ø–ª–æ—Ö–æ–π –¥–µ–ø–ª–æ–π –¥–∞–Ω–Ω—ã—Ö".
- **Reproducible ML**: "–û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏".

---

<!--
[–°–ª–∞–π–¥ 24]
**Maintenance**.
–¢–∞–±–ª–∏—Ü—ã –Ω—É–∂–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å.
1. Compaction: —Å–æ–±–∏—Ä–∞–µ–º –º–µ–ª–∫–∏–µ —Ñ–∞–π–ª—ã –≤ –±–æ–ª—å—à–∏–µ.
2. Expire Snapshots: —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã.
3. Orphan Files: —á–∏—Å—Ç–∏–º –º—É—Å–æ—Ä.
-->

# –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (Maintenance)

–¢–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±—É—é—Ç —É—Ö–æ–¥–∞, –∏–Ω–∞—á–µ –æ–Ω–∏ –¥–µ–≥—Ä–∞–¥–∏—Ä—É—é—Ç.

### 1. Compaction (Small Files Problem)
```sql
CALL catalog.system.rewrite_data_files(table => 'db.logs');
```

### 2. Expire Snapshots (Vacuum)
```sql
CALL catalog.system.expire_snapshots(
  table => 'db.logs',
  older_than => TIMESTAMP '...'
);
```

### 3. Remove Orphan Files (GC)
*–£–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä –æ—Ç —É–ø–∞–≤—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.*

---

<!--
[–°–ª–∞–π–¥ 25]
–î–µ–º–æ.
–ú—ã —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É, –ø–æ–ø–∏—à–µ–º –≤ –Ω–µ—ë –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª—ã.
-->

# –î–µ–º–æ: –ê–Ω–∞—Ç–æ–º–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

üõ† **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: PyIceberg + DuckDB

### –°—Ü–µ–Ω–∞—Ä–∏–π:
1. **Init**: –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É `taxi_dataset`.
2. **Inspect**: –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (`metadata/`, `data/`).
3. **Append**: –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ, –≤–∏–¥–∏–º –Ω–æ–≤—ã–π —Å–Ω–∞–ø—à–æ—Ç.
4. **Time Travel**: –ß–∏—Ç–∞–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é.
5. **Pruning**: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç—Å–µ—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

> üë®‚Äçüíª –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª...

---

<!--
[–°–ª–∞–π–¥ 26]
–ò—Ç–æ–≥–∏.
–ú—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –∏ –ø–æ–Ω—è–ª–∏, –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–∞–∂–¥—ã–π —Å–ª–æ–π.
Iceberg ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Data Lakehouse.
-->

# –ò—Ç–æ–≥–∏

Apache Iceberg –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Data Lake –≤ Data Warehouse.

1. **Metadata Tree**: `Catalog` &rarr; `Metadata` &rarr; `Manifest List` &rarr; `Manifest` &rarr; `Data`.
2. **Performance**: Pruning –æ—Ç—Å–µ–∫–∞–µ—Ç 99% —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
3. **Reliability**: ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, Safe Schema Evolution.
4. **Usability**: Hidden Partitioning, Time Travel.

### üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- üìÑ **Spec**: iceberg.apache.org/spec
- üêô **Code**: github.com/apache/iceberg

---

<!--
[–°–ª–∞–π–¥ 27]
–°–ø–∞—Å–∏–±–æ!
-->

# –í–æ–ø—Ä–æ—Å—ã?
